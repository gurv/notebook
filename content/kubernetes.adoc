= Kubernetes

* https://kubernetes.io/[site],
https://github.com/kubernetes/kubernetes[git],
https://kubernetes.io/docs/home/[docs],
https://kubernetes.io/docs/concepts/services-networking/service/[docs: Services],
https://kubernetes.io/docs/concepts/workloads/controllers/deployment/[docs: Deployments],
https://kubernetes.io/docs/concepts/storage/persistent-volumes/[docs: Persistent Volumes]

* kubectl на Windows

https://dl.k8s.io/v1.10.2/kubernetes-client-windows-386.tar.gz[Загрузить, например версию 1.10.2]

Файл конфигурации (создать/изменить):
```
C:\Users\GurV\.kube\config
```

* Полезное:
```
kubectl version
kubectl get pods
kubectl get po --namespace kube-system
kubectl describe pods

# delete
#   kubectl delete (-f FILENAME \| TYPE [NAME \| /NAME \| -l label \| --all]) [flags]
kubectl delete --all pods --namespace=default
kubectl delete --all services --namespace=default
kubectl delete --all deployments --namespace=default
kubectl delete --all pvc --namespace=default

# persistence volumes
kubectl create -f ./helm/pv.yaml
kubectl create -f ./helm/pvc.yaml
kubectl get pv
#helm install ./helm/postgresql --set persistence.existingClaim=pv-claim
kubectl delete pv pv01
```

https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application/[201811: Troubleshoot Applications]

https://habrahabr.ru/company/flant/blog/327338/["Хабр 201706: Зачем нужен Kubernetes и почему он больше, чем PaaS?"]

https://plugins.jetbrains.com/plugin/download?rel=true&updateId=44772[IDEA-плагин]

https://blog.jetbrains.com/idea/2018/03/intellij-idea-2018-1-kubernetes-support/["IntelliJ IDEA 2018.1: Kubernetes support"]

https://habr.com/company/southbridge/blog/346314/["2018: Понимание сети Kubernetes: сервисы"]


== minikube

(для ArchLinux)
```
# установить
#sudo systemctl stop docker
export MINIKUBE_HOME=/opt/app/.minikube
echo 'export MINIKUBE_HOME=/opt/app/.minikube' >> ~/.bashrc
# сверка версий в репо и уже установленной
#pacaur -i minikube
pacaur -S minikube
# конфигурация
minikube config set memory 16384
minikube config set disk-size 2000MB
minikube config set vm-driver virtualbox
#minikube config view
#cat $MINIKUBE_HOME/machines/minikube/config.json

# старт (тайминг: 1 мин)
minikube start

# будет в списке виртуалок
vboxmanage list vms
vboxmanage list runningvms

# останов 
minikube stop
#ps -ef | grep kube
#kill 4896

# удалить
#pacaur -R minikube
# очистить ~/.minikube/machines

# разное
minikube status
minikube ip
minikube dashboard
minikube docker-env
kubectl get services --all-namespaces
kubectl get pod
kubectl get nodes
kubectl config view
kubectl cluster-info
```

== Helm

* Полезное:

```
helm ls

# delete all
helm ls --short | xargs -L1 helm delete

kubectl get events

# установить
helm install ./helm/postgresql

# просмотр результатов обработки
helm template ./helm/postgresql

helm version
# список версий
helm list
# удалить версию
helm delete release_name

# репозитории
helm repo list
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm repo remove bitnami
helm search postgresql
```

== OpenShift

=== minishift

```
# Установка (ArchLinux и КVM)
#
# Setting Up the Virtualization Environment
#   (https://docs.okd.io/latest/minishift/getting-started/setting-up-virtualization-environment.html)
sudo pacman -S libvirt qemu dnsmasq ebtables
sudo usermod -a -G kvm,libvirt $(whoami)
sudo sed -ri 's/.?group\s?=\s?".+"/group = "kvm"/1' /etc/libvirt/qemu.conf
newgrp libvirt
# docker-machine-driver-kvm (root)
curl -L https://github.com/dhiltgen/docker-machine-kvm/releases/download/v0.10.0/docker-machine-driver-kvm-centos7 -o /usr/local/bin/docker-machine-driver-kvm
chmod +x /usr/local/bin/docker-machine-driver-kvm
# libvirtd
systemctl is-active libvirtd
sudo systemctl start libvirtd
# network
sudo virsh net-list --all
sudo virsh net-start default
sudo virsh net-autostart default
#
# Installing Minishift
#   (https://docs.okd.io/latest/minishift/getting-started/installing.html)
#
wget https://github.com/minishift/minishift/releases/download/v1.33.0/minishift-1.33.0-linux-amd64.tgz
tar zxvf minishift-1.33.0-linux-amd64.tgz
chmod +x minishift-1.33.0-linux-amd64/minishift
ln -sf /opt/app/minishift-1.33.0-linux-amd64.tgz/minishift /opt/app/minishift
minishift version
minishift start --skip-registration
#   по умолчанию, пользователь developer, пароль любой
#
# Разное
#
# переменные окружения: MINISHIFT_HOME, MINISHIFT_USERNAME, MINISHIFT_PASSWORD
# конфигурация
minishift config set memory 16g
# registry
oc adm registry --help
# мб пригодится
export HELM_HOST="$(minishift ip):$(oc get svc/tiller -o jsonpath='{.spec.ports[0].nodePort}' -n kube-system --as=system:admin)"
export MINISHIFT_ADMIN_CONTEXT="default/$(oc config view -o jsonpath='{.contexts[?(@.name=="minishift")].context.cluster}')/system:admin"
# kube-dashboard
minishift addons install /opt/tmp/minishift-addons/add-ons/kube-dashboard/
minishift addons apply kube-dashboard
minishift addons enable kube-dashboard
oc delete project/kube-dashboard --as=system:admin
# ...
minishift stop
minishift delete
minishift start --skip-registration --memory=16g
minishift openshift service dashboard -n kube-dashboard
kubectl get services --all-namespaces --as=system:admin
eval $(minishift docker-env)
docker version
# удалить
minishift delete
rm -rf ~/.minishift
# если висит minishift stop
ps -ef | grep shift
kill 11738
```
